@model IEnumerable<SuscripcionListViewModel>
@{
    ViewData["Title"] = "Suscripciones";
}

<div class="saas-dashboard">
    <header class="dashboard-hero">
        <h1>Suscripciones</h1>
        <p class="dashboard-subtitle">Estado y renovación de suscripciones por clínica.</p>
    </header>
    @if (TempData["Message"] != null)
    {
        <div class="page-alerts"><div class="alert alert-success">@TempData["Message"]</div></div>
    }
    <div class="section-card" style="margin-top: 1.25rem;">
        <table class="activity-table">
            <thead>
                <tr>
                    <th>Clínica</th>
                    <th>Inicio</th>
                    <th>Vencimiento</th>
                    <th>Activa</th>
                    <th>Suspendida</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var s in Model)
                {
                    <tr>
                        <td>@s.ClinicaNombre</td>
                        <td class="cell-date">@s.Inicio.ToString("dd/MM/yyyy")</td>
                        <td class="cell-date">@s.Vencimiento.ToString("dd/MM/yyyy")</td>
                        <td>@(s.Activa ? "Sí" : "No")</td>
                        <td>@(s.Suspendida ? "Sí" : "No")</td>
                        <td class="table-actions">
                            <a asp-area="Saas" asp-controller="Suscripciones" asp-action="Edit" asp-route-id="@s.Id" class="table-link">Editar fechas</a>
                            @if (!s.Activa || s.Suspendida)
                            {
                                <form asp-area="Saas" asp-controller="Suscripciones" asp-action="Activar" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@s.Id" />
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-success">Activar</button>
                                </form>
                            }
                            @if (s.Activa && !s.Suspendida)
                            {
                                <form asp-area="Saas" asp-controller="Suscripciones" asp-action="Suspender" method="post" class="d-inline">
                                    <input type="hidden" name="id" value="@s.Id" />
                                    @Html.AntiForgeryToken()
                                    <button type="submit" class="btn btn-sm btn-warning">Suspender</button>
                                </form>
                            }
                            <form asp-area="Saas" asp-controller="Suscripciones" asp-action="Renovar" method="post" class="d-inline">
                                <input type="hidden" name="id" value="@s.Id" />
                                <input type="hidden" name="meses" value="1" />
                                @Html.AntiForgeryToken()
                                <button type="submit" class="btn btn-sm btn-outline-primary">+1 mes</button>
                            </form>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    @if (!Model.Any())
    {
        <p class="section-empty">No hay suscripciones.</p>
    }
</div>
