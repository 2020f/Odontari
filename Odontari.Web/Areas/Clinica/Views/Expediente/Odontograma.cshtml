@{
    var paciente = ViewBag.Paciente as Odontari.Web.Models.Paciente;
    var estadoJson = ViewBag.EstadoJson as string ?? "{}";
    var pacienteId = paciente?.Id ?? 0;
    ViewData["Title"] = "Odontograma - " + (paciente?.Nombre ?? "");
}
@section Styles {
    <link rel="stylesheet" href="~/css/odontograma.css" asp-append-version="true" />
}

<div class="atencion-section">
    <div class="atencion-header">
        <h1>Odontograma — @paciente?.Nombre @paciente?.Apellidos</h1>
        <div class="meta">Evaluación dental del paciente</div>
        <div class="links mt-2">
            <a asp-action="Index" asp-route-id="@pacienteId">← Volver al Expediente</a>
        </div>
    </div>

    <div class="odontograma-pro">
        <div class="odontograma-panel-left">
            <h6>MODO DE EDICIÓN</h6>
            <div class="modo-edicion">
                <button type="button" class="btn-modo" id="btnModoSuperficie" data-modo="superficie">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/></svg>
                    Superficie
                </button>
                <button type="button" class="btn-modo active" id="btnModoDiente" data-modo="diente">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 2C8 2 6 4 6 8c0 4 2 8 6 14 4-6 6-10 6-14 0-4-2-6-6-6z"/></svg>
                    Diente
                </button>
            </div>

            <h6 id="labelEstados">ESTADOS DE DIENTE</h6>
            <div id="panelSuperficie" class="mb-2" style="display:none">
                <div class="estados-superficie">
                    <button type="button" class="btn-estado" data-state="CARIES"><span class="swatch" style="background:#E53935"></span>Caries</button>
                    <button type="button" class="btn-estado" data-state="OBTURACION"><span class="swatch" style="background:#1E88E5"></span>Obturación</button>
                    <button type="button" class="btn-estado" data-state="SELLANTE"><span class="swatch" style="background:#26C6DA"></span>Sellante</button>
                    <button type="button" class="btn-estado" data-state="FRACTURA"><span class="swatch" style="background:#FF8F00"></span>Fractura</button>
                    <button type="button" class="btn-estado" data-state="NONE"><span class="swatch" style="background:#b0bec5;border-style:dashed"></span>Borrar</button>
                </div>
            </div>
            <div id="panelDiente" class="mb-2">
                <div class="estados-diente">
                    <button type="button" class="btn-estado active" data-state="NONE"><span class="swatch" style="background:#fff;border:1px solid #999"></span>Normal</button>
                    <button type="button" class="btn-estado" data-state="AUSENTE"><span class="swatch" style="background:#78909C"></span>Ausente</button>
                    <button type="button" class="btn-estado" data-state="EXTRAIDO"><span class="swatch" style="background:#C62828"></span>Extraído</button>
                    <button type="button" class="btn-estado" data-state="CORONA"><span class="swatch" style="background:#F9A825"></span>Corona</button>
                    <button type="button" class="btn-estado" data-state="ENDODONCIA"><span class="swatch" style="background:#2E7D32"></span>Endodoncia</button>
                    <button type="button" class="btn-estado" data-state="IMPLANTE"><span class="swatch" style="background:#6A1B9A"></span>Implante</button>
                    <button type="button" class="btn-estado" data-state="PROTESIS"><span class="swatch" style="background:#00838F"></span>Prótesis</button>
                </div>
            </div>

            <div class="odontograma-leyenda">
                <h6>LEYENDA</h6>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#E53935"></span>Caries</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#1E88E5"></span>Obturación</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#26C6DA"></span>Sellante</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#FF8F00"></span>Fractura</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#78909C"></span>Ausente</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#C62828"></span>Extraído</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#F9A825"></span>Corona</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#2E7D32"></span>Endodoncia</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#6A1B9A"></span>Implante</div>
                <div class="leyenda-item"><span class="leyenda-swatch" style="background:#00838F"></span>Prótesis</div>
            </div>
        </div>

        <div class="odontograma-panel-center">
            <div class="odontograma-card">
                <div class="orientacion">
                    <span>Derecho del paciente</span>
                    <span>Izquierdo del paciente</span>
                </div>
                <div class="arcada-label-top">ARCADA SUPERIOR</div>
                <div class="odontograma-svg-wrap">
                    <svg id="odontogramaSvg" class="odontograma-svg" width="800" height="420" xmlns="http://www.w3.org/2000/svg"></svg>
                </div>
                <div class="arcada-label-bottom">ARCADA INFERIOR</div>
            </div>
            <button type="button" class="btn-guardar-odon mt-3" id="btnGuardar">Guardar odontograma</button>
            <span id="guardarMsg" class="ms-2 text-muted small"></span>
        </div>

        <div class="odontograma-panel-right">
            <div>
                <h6>HALLAZGOS</h6>
                <div id="hallazgos" class="hallazgos-list">Sin hallazgos registrados.</div>
            </div>
            <div>
                <h6>OBSERVACIONES</h6>
                <textarea id="observaciones" class="odontograma-observaciones form-control" placeholder="Notas clínicas adicionales..."></textarea>
            </div>
            <div>
                <h6>ESTADÍSTICAS</h6>
                <div class="odontograma-stats">
                    <div class="odontograma-stat"><span class="number" id="statHallazgos">0</span><br><span class="label">Hallazgos</span></div>
                    <div class="odontograma-stat"><span class="number" id="statDientes">0</span><br><span class="label">Dientes afectados</span></div>
                </div>
            </div>
        </div>
    </div>
</div>

<input type="hidden" id="pacienteId" value="@pacienteId" />
<input type="hidden" id="estadoInicial" value="@Html.Raw(estadoJson)" />

@section Scripts {
    <script src="~/js/odontograma.js" asp-append-version="true"></script>
}
