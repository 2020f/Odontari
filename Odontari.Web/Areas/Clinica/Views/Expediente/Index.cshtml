@model Odontari.Web.ViewModels.ExpedienteIndexViewModel
@{
    var paciente = ViewBag.Paciente as Odontari.Web.Models.Paciente;
    ViewData["Title"] = "Expediente - " + Model.Nombre;
}

<h1>Expediente: @Model.Nombre @Model.Apellidos</h1>
<p class="text-muted">@Model.Cedula | @Model.Telefono</p>
<p><a asp-controller="Pacientes" asp-action="Index">← Volver a Pacientes</a></p>

@if (!string.IsNullOrEmpty(Model.Alergias))
{
    <div class="alert alert-warning">
        <strong>Alergias:</strong> @Model.Alergias
    </div>
}

<ul class="nav nav-tabs mb-3" role="tablist">
    <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#resumen">Resumen</a></li>
    <li class="nav-item"><a class="nav-link" asp-action="Histograma" asp-route-id="@Model.PacienteId">Histograma</a></li>
    <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#historial">Historial</a></li>
    <li class="nav-item"><a class="nav-link" asp-action="Odontograma" asp-route-id="@Model.PacienteId">Odontograma</a></li>
    <li class="nav-item"><a class="nav-link" asp-action="HistoriaClinicaSistematica" asp-route-id="@Model.PacienteId">Historia Clínica Sistemática</a></li>
</ul>

<div class="tab-content">
    <div id="resumen" class="tab-pane fade show active">
        <h3>Datos generales</h3>
        <dl class="row">
            <dt class="col-sm-2">Nombre</dt>
            <dd class="col-sm-10">@Model.Nombre @Model.Apellidos</dd>
            <dt class="col-sm-2">Cédula</dt>
            <dd class="col-sm-10">@(Model.Cedula ?? "—")</dd>
            <dt class="col-sm-2">Teléfono</dt>
            <dd class="col-sm-10">@(Model.Telefono ?? "—")</dd>
            <dt class="col-sm-2">Alergias</dt>
            <dd class="col-sm-10">@(Model.Alergias ?? "Ninguna registrada")</dd>
            <dt class="col-sm-2">Notas clínicas</dt>
            <dd class="col-sm-10">@(Model.NotasClinicas ?? "—")</dd>
        </dl>
        <p>
            <a asp-action="Odontograma" asp-route-id="@Model.PacienteId" class="btn btn-primary">Abrir Odontograma</a>
            <a asp-action="HistoriaClinicaSistematica" asp-route-id="@Model.PacienteId" class="btn btn-outline-secondary">Historia Clínica Sistemática</a>
        </p>
    </div>
    <div id="historial" class="tab-pane fade">
        <h3>Historial clínico (últimos 20 eventos)</h3>
        <table class="table table-sm">
            <thead><tr><th>Fecha</th><th>Tipo</th><th>Descripción</th></tr></thead>
            <tbody>
                @foreach (var h in Model.Historial)
                {
                    <tr>
                        <td>@h.FechaEvento.ToString("dd/MM/yyyy HH:mm")</td>
                        <td>@h.TipoEvento</td>
                        <td>@(h.Descripcion ?? "—")</td>
                    </tr>
                }
            </tbody>
        </table>
        @if (!Model.Historial.Any())
        {
            <p class="text-muted">No hay eventos registrados.</p>
        }
    </div>
</div>
