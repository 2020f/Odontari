@model IEnumerable<Odontari.Web.Models.Cita>
@using Odontari.Web.Models.Enums
@{
    var fecha = (DateTime)ViewBag.Fecha;
    ViewData["Title"] = "Mis citas";
}
@section Styles {
    <link rel="stylesheet" href="~/css/dashboard.css" asp-append-version="true" />
}

<div class="content-header">
    <h1>Mis citas del día</h1>
    <p class="mb-0 text-muted small">@fecha.ToString("dd/MM/yyyy")</p>
    <div class="d-flex gap-2">
        <a asp-action="Index" asp-route-fecha="@fecha.AddDays(-1)" class="btn-content-secondary">‹ Día anterior</a>
        <a asp-action="Index" asp-route-fecha="@fecha.AddDays(1)" class="btn-content-secondary">Día siguiente ›</a>
    </div>
</div>
<div class="content-card">
    @if (Model.Any())
    {
        <div class="card-body p-0">
            @foreach (var c in Model)
            {
                var inicial = (c.Paciente?.Nombre ?? "?").Length > 0 ? char.ToUpperInvariant((c.Paciente?.Nombre ?? "?")[0]).ToString() : "?";
                <div class="dashboard-list-item">
                    <div class="avatar">@inicial</div>
                    <div class="body">
                        <div class="title">@(c.Paciente?.Nombre) @(c.Paciente?.Apellidos)</div>
                        <div class="sub">@(c.Motivo ?? "Consulta") · @c.Estado</div>
                    </div>
                    <span class="hora">@c.FechaHora.ToString("HH:mm")</span>
                    @if (c.Estado == EstadoCita.EnSala || c.Estado == EstadoCita.EnAtencion)
                    {
                        <a asp-action="Expediente" asp-route-id="@c.Id" class="btn btn-primary btn-sm">Expediente</a>
                    }
                    @if (c.Estado == EstadoCita.EnAtencion)
                    {
                        <form asp-action="FinalizarAtencion" method="post" class="d-inline">
                            <input type="hidden" name="id" value="@c.Id" />
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-success btn-sm">Finalizar (cobro)</button>
                        </form>
                    }
                </div>
            }
        </div>
    }
    else
    {
        <div class="content-empty">No tienes citas este día.</div>
    }
</div>
